# GraphRAG 챗봇 플랫폼 사용자 매뉴얼

## 버전 정보
- **문서 버전**: 1.0.0
- **최종 수정일**: 2025년 12월
- **대상 시스템**: GraphRAG-vLLM v1.0

---

# 목차

1. [시스템 소개](#1-시스템-소개)
2. [핵심 특징 및 장점](#2-핵심-특징-및-장점)
3. [시스템 구성](#3-시스템-구성)
4. [설치 가이드](#4-설치-가이드)
5. [관리자 사용법](#5-관리자-사용법)
6. [일반 사용자 사용법](#6-일반-사용자-사용법)
7. [모니터링 및 통계](#7-모니터링-및-통계)
8. [유지보수 가이드](#8-유지보수-가이드)
9. [문제 해결](#9-문제-해결)
10. [부록](#10-부록)

---

# 1. 시스템 소개

## 1.1 GraphRAG 챗봇 플랫폼이란?

GraphRAG 챗봇 플랫폼은 **회사 내부 문서를 기반으로 질문에 답변하는 AI 챗봇 시스템**입니다.

사내 매뉴얼, 규정집, 기술 문서 등을 업로드하면 AI가 문서 내용을 학습하고, 직원들이 채팅 형태로 질문하면 관련 내용을 찾아 답변해 드립니다.

### 쉽게 이해하기

```
[기존 방식]
직원: "휴가 신청 절차가 어떻게 되나요?"
       ↓
   인사팀에 전화 또는 규정집 직접 검색
       ↓
   시간 소요 + 업무 중단

[GraphRAG 사용 시]
직원: "휴가 신청 절차가 어떻게 되나요?"
       ↓
   AI 챗봇이 즉시 관련 규정을 찾아 답변
       ↓
   즉각적인 해결 + 출처까지 제공
```

## 1.2 이런 분들에게 추천합니다

| 대상 | 활용 사례 |
|------|----------|
| **인사팀** | 인사규정, 복리후생, 휴가/출장 관련 질문 대응 자동화 |
| **IT팀** | 사내 시스템 매뉴얼, 장애 대응 가이드 제공 |
| **영업팀** | 제품 사양서, 가격표, FAQ 즉시 검색 |
| **연구개발팀** | 기술 문서, 설계 자료 기반 지식 공유 |
| **법무팀** | 계약서 양식, 법률 검토 가이드 제공 |

---

# 2. 핵심 특징 및 장점

## 2.1 완벽한 데이터 보안

### 왜 중요한가요?

ChatGPT, Claude 같은 외부 AI 서비스를 사용하면 **회사 기밀 문서가 외부 서버로 전송**됩니다. 이는 다음과 같은 위험을 초래합니다:

- 기업 기밀 유출 가능성
- 개인정보보호법 위반 우려
- 경쟁사로의 정보 노출 위험

### GraphRAG의 해결책

```
┌─────────────────────────────────────────────────────────┐
│                    회사 내부 네트워크                      │
│  ┌─────────┐    ┌─────────┐    ┌─────────────────────┐  │
│  │ 사용자   │ ←→ │ 챗봇    │ ←→ │ 로컬 AI 서버 (vLLM) │  │
│  │ (직원)  │    │ 서버    │    │ 회사 서버에서 실행    │  │
│  └─────────┘    └─────────┘    └─────────────────────┘  │
│                                                         │
│  ★ 모든 데이터가 회사 내부에서만 처리됩니다                  │
│  ★ 외부 인터넷 연결이 필요 없습니다                        │
│  ★ 완벽한 데이터 주권 확보                                │
└─────────────────────────────────────────────────────────┘
```

**보안 장점 요약:**
- 모든 AI 처리가 사내 서버에서 실행
- 문서 데이터가 외부로 전송되지 않음
- 폐쇄망(인터넷 차단 환경)에서도 운영 가능
- 보안 감사 및 규정 준수 용이

## 2.2 비용 절감 효과

### 외부 AI 서비스 비용 비교

| 서비스 | 월 비용 (30명 기준 추정) | 특징 |
|--------|------------------------|------|
| ChatGPT Enterprise | $60 × 30명 = **$1,800/월** | 사용자당 과금 |
| Azure OpenAI | 토큰 사용량 기반 **$500~2,000/월** | 사용량에 따라 변동 |
| **GraphRAG (로컬)** | 초기 서버 투자 후 **$0/월** | 추가 비용 없음 |

### 3년간 비용 비교

```
외부 서비스: $1,800 × 36개월 = $64,800 (약 8,400만원)
GraphRAG:   서버 구축비 1,500만원 + 운영비 0원 = 1,500만원

★ 3년간 약 6,900만원 절감 효과
```

## 2.3 고성능 서비스 (vLLM 기술)

### vLLM이란?

vLLM은 대형 언어 모델(LLM)을 매우 빠르게 실행할 수 있게 해주는 기술입니다.

### 성능 비교

```
일반 LLM 서버:    질문 → [5~10초 대기] → 답변
vLLM 적용 서버:   질문 → [1~3초 대기] → 답변

★ 2~5배 빠른 응답 속도
```

### 20~30명 동시 사용 가능

| 시나리오 | 처리 능력 |
|---------|----------|
| 동시 질문 5개 | 모두 3초 이내 응답 |
| 동시 질문 10개 | 모두 5초 이내 응답 |
| 동시 질문 20개 | 모두 8초 이내 응답 |
| 하루 총 질문 수 | 1,000건 이상 처리 가능 |

**기업 환경에 적합한 이유:**
- 부서 단위(20~30명) 사용에 최적화
- 업무 시간 피크 타임에도 안정적 응답
- 대기 시간 없이 즉시 답변 제공

## 2.4 지능형 검색 (GraphRAG 기술)

### 일반 검색 vs GraphRAG 검색

```
[일반 키워드 검색]
질문: "김부장님이 작년에 진행한 프로젝트 예산은?"
결과: "김부장" 또는 "프로젝트" 포함된 모든 문서 나열
      → 원하는 정보 찾기 어려움

[GraphRAG 검색]
질문: "김부장님이 작년에 진행한 프로젝트 예산은?"
결과:
  1. 김부장 → 프로젝트A 담당 관계 파악
  2. 프로젝트A → 2024년 예산 3억원 연결
  3. 정확한 답변: "김부장님이 담당한 프로젝트A의
     2024년 예산은 3억원입니다."
```

### 지식 그래프 시각화

시스템은 문서에서 자동으로 엔티티(사람, 조직, 프로젝트 등)와 관계를 추출하여 연결합니다:

```
     ┌─────────┐
     │ 김부장  │
     └────┬────┘
          │ 담당
          ▼
   ┌──────────────┐
   │  프로젝트A    │
   └──────┬───────┘
          │ 예산
          ▼
     ┌─────────┐
     │  3억원   │
     └─────────┘
```

---

# 3. 시스템 구성

## 3.1 전체 아키텍처

```
┌──────────────────────────────────────────────────────────────────┐
│                        사용자 영역                                │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌──────────────┐         ┌──────────────┐                      │
│   │   관리자      │         │   일반 직원   │                      │
│   │   (웹 브라우저)│         │   (웹 브라우저)│                      │
│   └──────┬───────┘         └──────┬───────┘                      │
│          │                        │                              │
└──────────┼────────────────────────┼──────────────────────────────┘
           │                        │
           ▼                        ▼
┌──────────────────────────────────────────────────────────────────┐
│                        서비스 영역                                │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌──────────────────┐    ┌──────────────────┐                   │
│   │   프론트엔드      │    │    백엔드 API     │                   │
│   │   (React 웹앱)    │◄──►│    (FastAPI)     │                   │
│   │   포트: 13000     │    │   포트: 18000     │                   │
│   └──────────────────┘    └────────┬─────────┘                   │
│                                    │                             │
└────────────────────────────────────┼─────────────────────────────┘
                                     │
                                     ▼
┌──────────────────────────────────────────────────────────────────┐
│                         AI 처리 영역                              │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌──────────────────┐    ┌──────────────────┐                   │
│   │   vLLM 서버       │    │  임베딩 서버      │                   │
│   │ (언어 모델 실행)   │    │ (문서 벡터화)     │                   │
│   │   포트: 18001     │    │   포트: 18003     │                   │
│   │ GPU 사용 (CUDA)   │    │ GPU 사용 (CUDA)   │                   │
│   └──────────────────┘    └──────────────────┘                   │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
                                     │
                                     ▼
┌──────────────────────────────────────────────────────────────────┐
│                        데이터 저장 영역                           │
├──────────────────────────────────────────────────────────────────┤
│                                                                  │
│   ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐ │
│   │ PostgreSQL │  │   Neo4j    │  │   Qdrant   │  │   Redis    │ │
│   │ (메타데이터) │  │(지식그래프) │  │ (벡터 DB)  │  │  (캐시)    │ │
│   │포트: 15432 │  │포트: 17474 │  │포트: 16333 │  │포트: 16379 │ │
│   └────────────┘  └────────────┘  └────────────┘  └────────────┘ │
│                                                                  │
└──────────────────────────────────────────────────────────────────┘
```

## 3.2 구성 요소 설명

### 사용자가 직접 접속하는 서비스

| 구성요소 | 접속 주소 | 용도 |
|---------|----------|------|
| **프론트엔드** | http://서버IP:13000 | 관리자 화면 (챗봇 관리, 문서 업로드) |
| **챗봇 페이지** | http://서버IP:13000/chat/접속코드 | 일반 직원 채팅 화면 |
| **API 문서** | http://서버IP:18000/docs | 개발자용 API 문서 |

### 관리/모니터링 도구

| 구성요소 | 접속 주소 | 용도 |
|---------|----------|------|
| **Neo4j Browser** | http://서버IP:17474 | 지식 그래프 시각화 |
| **Flower** | http://서버IP:15555 | 백그라운드 작업 모니터링 |

### 백엔드 서비스 (자동 실행)

| 구성요소 | 역할 |
|---------|------|
| **FastAPI 백엔드** | API 서버, 요청 처리 |
| **vLLM 서버** | AI 언어 모델 실행 |
| **임베딩 서버** | 문서를 숫자 벡터로 변환 |
| **Celery Worker** | 문서 처리 등 백그라운드 작업 |

### 데이터베이스

| 구성요소 | 저장 데이터 |
|---------|------------|
| **PostgreSQL** | 사용자 정보, 챗봇 설정, 대화 기록 |
| **Neo4j** | 문서에서 추출한 지식 그래프 |
| **Qdrant** | 문서 임베딩 벡터 |
| **Redis** | 임시 데이터, 세션 정보 |

## 3.3 하드웨어 요구사항

### 최소 사양 (10~15명 사용)

| 항목 | 최소 사양 |
|------|----------|
| **CPU** | 8코어 이상 |
| **RAM** | 32GB 이상 |
| **GPU** | NVIDIA RTX 3090 (24GB VRAM) |
| **SSD** | 500GB 이상 |
| **네트워크** | 1Gbps |

### 권장 사양 (20~30명 사용)

| 항목 | 권장 사양 |
|------|----------|
| **CPU** | 16코어 이상 (Intel Xeon 또는 AMD EPYC) |
| **RAM** | 64GB 이상 |
| **GPU** | NVIDIA RTX 4090 (24GB) 또는 A100 (40GB/80GB) |
| **SSD** | 1TB NVMe SSD |
| **네트워크** | 10Gbps |

### GPU 선택 가이드

| GPU 모델 | VRAM | 동시 사용자 | 가격대 |
|---------|------|------------|--------|
| RTX 3090 | 24GB | 10~15명 | 약 200만원 |
| RTX 4090 | 24GB | 15~20명 | 약 300만원 |
| A100 40GB | 40GB | 25~35명 | 약 1,500만원 |
| A100 80GB | 80GB | 40~50명 | 약 2,500만원 |

---

# 4. 설치 가이드

## 4.1 사전 준비

### 운영체제 요구사항
- Ubuntu 22.04 LTS (권장)
- 또는 Ubuntu 20.04 LTS

### 필수 소프트웨어 설치

#### 1단계: Docker 설치

```bash
# Docker 설치
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# 현재 사용자를 docker 그룹에 추가
sudo usermod -aG docker $USER

# 변경사항 적용을 위해 로그아웃 후 다시 로그인
```

#### 2단계: NVIDIA 드라이버 설치

```bash
# NVIDIA 드라이버 설치
sudo apt update
sudo apt install -y nvidia-driver-535

# 시스템 재부팅
sudo reboot
```

#### 3단계: NVIDIA Container Toolkit 설치

```bash
# NVIDIA Container Toolkit 설치
distribution=$(. /etc/os-release;echo $ID$VERSION_ID)
curl -s -L https://nvidia.github.io/nvidia-docker/gpgkey | sudo apt-key add -
curl -s -L https://nvidia.github.io/nvidia-docker/$distribution/nvidia-docker.list | sudo tee /etc/apt/sources.list.d/nvidia-docker.list

sudo apt update
sudo apt install -y nvidia-container-toolkit

# Docker 재시작
sudo systemctl restart docker
```

#### 4단계: 설치 확인

```bash
# Docker 확인
docker --version
# 출력 예: Docker version 24.0.7

# GPU 확인
nvidia-smi
# GPU 정보가 표시되어야 함

# Docker에서 GPU 접근 확인
docker run --rm --gpus all nvidia/cuda:12.1-base nvidia-smi
# GPU 정보가 표시되어야 함
```

## 4.2 시스템 설치

### 1단계: 소스코드 다운로드

```bash
# 홈 디렉토리에 설치
cd ~

# Git으로 소스코드 다운로드
git clone https://github.com/edumagiceco/GraphRAG.git

# 디렉토리 이동
cd GraphRAG/docker
```

### 2단계: 환경설정 파일 생성

```bash
# 환경설정 템플릿 복사
cp .env.example .env

# 환경설정 편집
nano .env
```

### 3단계: 환경설정 수정

`.env` 파일을 열어 아래 항목을 수정합니다:

```bash
# ===================================
# 필수 보안 설정 (반드시 변경하세요!)
# ===================================

# PostgreSQL 비밀번호 (영문+숫자 조합 16자 이상 권장)
POSTGRES_PASSWORD=여기에_안전한_비밀번호_입력

# Neo4j 비밀번호
NEO4J_PASSWORD=여기에_안전한_비밀번호_입력

# JWT 시크릿 키 (32자 이상의 랜덤 문자열)
JWT_SECRET_KEY=여기에_32자_이상의_랜덤_문자열_입력

# 초기 관리자 계정
ADMIN_EMAIL=admin@회사도메인.com
ADMIN_PASSWORD=초기관리자비밀번호

# ===================================
# AI 모델 설정 (기본값 사용 가능)
# ===================================

# 언어 모델 (한국어 지원)
VLLM_MODEL=spow12/Ko-Qwen2-7B-Instruct

# 임베딩 모델 (한국어 최적화)
VLLM_EMBEDDING_MODEL=upskyy/bge-m3-korean
```

**강력한 비밀번호 생성 예시:**
```bash
# 랜덤 비밀번호 생성 명령어
openssl rand -base64 32
```

### 4단계: 시스템 시작

```bash
# 모든 서비스 시작 (첫 실행 시 10~30분 소요)
docker compose up -d

# 시작 상태 확인
docker compose ps
```

### 5단계: 설치 확인

모든 서비스가 정상 실행되면 다음과 같이 표시됩니다:

```
NAME                        STATUS
graphrag-vllm-backend       Up (healthy)
graphrag-vllm-frontend      Up
graphrag-vllm-postgres      Up (healthy)
graphrag-vllm-neo4j         Up (healthy)
graphrag-vllm-qdrant        Up (healthy)
graphrag-vllm-redis         Up (healthy)
graphrag-vllm-llm           Up (healthy)
graphrag-vllm-embed         Up (healthy)
graphrag-vllm-celery-worker Up
graphrag-vllm-flower        Up
```

### 6단계: 접속 확인

웹 브라우저에서 접속해봅니다:

1. **관리자 페이지**: http://서버IP:13000
   - 설정한 관리자 이메일/비밀번호로 로그인

2. **API 상태 확인**: http://서버IP:18000/api/v1/health
   - `{"status": "healthy"}` 응답 확인

## 4.3 첫 번째 챗봇 만들기

### 1단계: 관리자 로그인

1. http://서버IP:13000 접속
2. 설정한 관리자 이메일과 비밀번호 입력
3. 로그인 버튼 클릭

### 2단계: 챗봇 생성

1. **"새 챗봇 만들기"** 버튼 클릭
2. 챗봇 정보 입력:
   - **이름**: 예) "인사팀 도우미"
   - **설명**: 예) "인사 규정 관련 질문에 답변합니다"
   - **접속 URL**: 예) "hr-helper" (영문, 숫자, 하이픈만 사용)
3. **"생성"** 버튼 클릭

### 3단계: 문서 업로드

1. 생성된 챗봇 클릭하여 상세 페이지 이동
2. **"문서 업로드"** 버튼 클릭
3. PDF 또는 TXT 파일 선택 (드래그 앤 드롭 가능)
4. 업로드 진행률 확인 (문서 처리에 수 분 소요)

### 4단계: 챗봇 테스트

1. 문서 처리 완료 후 **"채팅 테스트"** 버튼 클릭
2. 채팅 페이지에서 질문 입력
3. AI 응답 및 출처 확인

### 5단계: 직원들에게 공유

챗봇 접속 URL을 직원들에게 공유합니다:
```
http://서버IP:13000/chat/hr-helper
```

---

# 5. 관리자 사용법

## 5.1 관리자 대시보드

### 로그인 후 메인 화면

로그인하면 챗봇 목록 화면이 표시됩니다:

```
┌─────────────────────────────────────────────────────────────┐
│  GraphRAG 관리자                              [로그아웃]     │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  [+ 새 챗봇 만들기]                                          │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 인사팀 도우미                               [활성]    │   │
│  │ 인사 규정 관련 질문에 답변합니다                       │   │
│  │ 문서: 5개  |  접속: /chat/hr-helper                  │   │
│  │ [상세보기] [통계] [비활성화]                          │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ IT 헬프데스크                               [활성]    │   │
│  │ 사내 시스템 사용법을 안내합니다                        │   │
│  │ 문서: 12개  |  접속: /chat/it-help                   │   │
│  │ [상세보기] [통계] [비활성화]                          │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

## 5.2 챗봇 관리

### 새 챗봇 만들기

1. **"새 챗봇 만들기"** 버튼 클릭

2. 필수 정보 입력:

| 항목 | 설명 | 예시 |
|------|------|------|
| **챗봇 이름** | 챗봇을 식별할 이름 | 인사팀 도우미 |
| **설명** | 챗봇의 용도 설명 | 인사 규정 관련 질문 답변 |
| **접속 URL** | 직원들이 접속할 주소 | hr-helper |

3. 고급 설정 (선택):

| 항목 | 설명 | 기본값 |
|------|------|--------|
| **시스템 프롬프트** | AI의 성격/역할 정의 | 기본 프롬프트 |
| **응답 스타일** | 답변 형식 지정 | 친절하고 자세하게 |

### 챗봇 수정

1. 챗봇 목록에서 **"상세보기"** 클릭
2. 우측 상단 **"수정"** 버튼 클릭
3. 정보 수정 후 **"저장"** 클릭

### 챗봇 활성화/비활성화

- **비활성화**: 직원들의 접근을 일시적으로 차단
- **활성화**: 다시 접근 허용

```
[활성 상태]  → [비활성화] 버튼 클릭 → [비활성 상태]
                                       직원 접근 불가
```

### 챗봇 삭제

> **주의**: 삭제된 챗봇과 관련 문서는 복구할 수 없습니다.

1. 챗봇 상세 페이지에서 **"삭제"** 버튼 클릭
2. 확인 대화상자에서 챗봇 이름 입력
3. **"삭제 확인"** 클릭

## 5.3 문서 관리

### 지원 파일 형식

| 형식 | 확장자 | 권장 크기 |
|------|--------|----------|
| PDF | .pdf | 50MB 이하 |
| 텍스트 | .txt | 10MB 이하 |

### 문서 업로드 방법

1. 챗봇 상세 페이지로 이동
2. **"문서 업로드"** 버튼 클릭
3. 파일 선택 또는 드래그 앤 드롭
4. 업로드 진행 상태 확인:

```
┌─────────────────────────────────────────────────┐
│ 인사규정_2024.pdf                               │
│ ████████████████░░░░░░░░░░░░░░ 60%             │
│ 처리 중: 엔티티 추출                             │
└─────────────────────────────────────────────────┘
```

### 문서 처리 단계

| 단계 | 설명 | 예상 시간 |
|------|------|----------|
| 1. 업로드 | 파일 서버 전송 | 수초 |
| 2. 텍스트 추출 | PDF에서 텍스트 추출 | 1~2분 |
| 3. 청킹 | 의미 단위로 분할 | 1분 |
| 4. 임베딩 | 벡터 변환 | 2~5분 |
| 5. 그래프 생성 | 엔티티/관계 추출 | 5~15분 |
| 6. 완료 | 검색 가능 상태 | - |

### 문서 삭제

1. 문서 목록에서 삭제할 문서의 **"삭제"** 버튼 클릭
2. 확인 대화상자에서 **"확인"** 클릭

> **참고**: 문서 삭제 시 해당 문서의 지식 그래프와 벡터도 함께 삭제됩니다.

## 5.4 버전 관리

문서 세트를 버전으로 관리할 수 있습니다.

### 버전이란?

특정 시점의 문서 구성을 저장하여, 필요시 이전 버전으로 되돌릴 수 있습니다.

```
버전 1 (2024년 1월)
├── 인사규정_v1.pdf
└── 휴가규정_v1.pdf

버전 2 (2024년 6월) ← 현재 활성
├── 인사규정_v2.pdf (업데이트)
├── 휴가규정_v1.pdf
└── 출장규정.pdf (신규)
```

### 버전 활성화

1. 챗봇 상세 페이지에서 **"버전"** 탭 클릭
2. 원하는 버전의 **"활성화"** 버튼 클릭
3. 해당 버전의 문서 기반으로 응답 생성

## 5.5 시스템 설정

### 모델 설정

**설정 > 모델 설정**에서 AI 모델을 변경할 수 있습니다:

| 설정 항목 | 설명 |
|----------|------|
| LLM 모델 | 답변 생성에 사용할 언어 모델 |
| 임베딩 모델 | 문서 벡터화에 사용할 모델 |
| vLLM 서버 URL | vLLM 서버 접속 주소 |

### 연결 테스트

**"연결 테스트"** 버튼을 클릭하여 AI 서버 연결 상태를 확인할 수 있습니다.

---

# 6. 일반 사용자 사용법

## 6.1 챗봇 접속

### 접속 방법

관리자로부터 받은 URL로 접속합니다:

```
http://서버주소:13000/chat/챗봇접속코드

예시: http://192.168.1.100:13000/chat/hr-helper
```

### 로그인 없이 사용

일반 직원은 **별도 로그인 없이** 바로 채팅을 시작할 수 있습니다.

## 6.2 채팅 화면 구성

```
┌─────────────────────────────────────────────────────────────┐
│  인사팀 도우미                                               │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 안녕하세요! 인사 규정에 대해 궁금한 점을 질문해 주세요.  │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │                                     연차 사용 방법은? │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
│  ┌─────────────────────────────────────────────────────┐   │
│  │ 연차휴가 사용 절차는 다음과 같습니다:                    │   │
│  │                                                       │   │
│  │ 1. 연차 신청서 작성                                    │   │
│  │ 2. 팀장 승인 → 인사팀 확인                             │   │
│  │ 3. 휴가 사용                                          │   │
│  │                                                       │   │
│  │ [출처: 인사규정 제15조]                                │   │
│  └─────────────────────────────────────────────────────┘   │
│                                                             │
├─────────────────────────────────────────────────────────────┤
│  [질문을 입력하세요...]                          [전송]     │
└─────────────────────────────────────────────────────────────┘
```

## 6.3 효과적인 질문 방법

### 좋은 질문 예시

| 질문 유형 | 좋은 예시 | 피해야 할 예시 |
|----------|----------|---------------|
| **구체적** | "연차휴가 신청 절차는 어떻게 되나요?" | "휴가" |
| **명확한** | "해외 출장 시 경비 정산 기한은?" | "출장 관련해서" |
| **한 가지씩** | "육아휴직 신청 자격 조건은?" | "육아휴직이랑 출산휴가 다 알려줘" |

### 질문 팁

1. **구체적으로 질문하기**
   - ❌ "규정이 뭐야?"
   - ✅ "야근 수당 지급 기준은 어떻게 되나요?"

2. **한 번에 하나씩 질문하기**
   - ❌ "휴가랑 출장이랑 경비 다 알려줘"
   - ✅ "연차휴가 일수는 어떻게 계산되나요?"
   - 그 다음: "출장 경비 정산은 어떻게 하나요?"

3. **원하는 정보 명시하기**
   - ❌ "휴직"
   - ✅ "육아휴직 중 급여는 어떻게 되나요?"

## 6.4 답변 이해하기

### 답변 구성

AI 답변은 다음과 같이 구성됩니다:

1. **본문 답변**: 질문에 대한 직접적인 답변
2. **출처 표시**: 답변의 근거가 된 문서와 위치

### 출처 확인

```
[출처: 인사규정 제15조 제2항]
```

출처를 클릭하면 해당 문서의 원문을 확인할 수 있습니다.

### 추가 질문

첫 번째 답변이 충분하지 않다면, 더 구체적으로 질문하세요:

```
사용자: 연차 사용 방법은?
AI: 연차휴가 신청 절차는... [출처: 인사규정 제15조]

사용자: 연차가 남으면 이월되나요?
AI: 미사용 연차의 이월 규정은... [출처: 인사규정 제16조]
```

## 6.5 주의사항

1. **정확한 정보 확인**
   - AI 답변은 업로드된 문서를 기반으로 합니다
   - 중요한 결정은 담당 부서에 반드시 확인하세요

2. **최신 정보**
   - 문서가 업데이트되면 답변도 변경됩니다
   - 최신 버전인지 관리자에게 문의하세요

3. **개인정보 주의**
   - 채팅 내용은 기록될 수 있습니다
   - 민감한 개인정보는 입력하지 마세요

---

# 7. 모니터링 및 통계

## 7.1 통계 대시보드

관리자는 각 챗봇의 사용 현황을 실시간으로 확인할 수 있습니다.

### 대시보드 접속

1. 관리자 로그인
2. 챗봇 목록에서 **"통계"** 버튼 클릭

### 대시보드 화면

```
┌─────────────────────────────────────────────────────────────────┐
│  인사팀 도우미 - 모니터링 대시보드                    [새로고침]  │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐        │
│  │ 총 세션   │  │ 총 메시지 │  │ 평균 응답  │  │ P95 응답  │        │
│  │   127    │  │   543    │  │  2.4초    │  │  4.5초   │        │
│  └──────────┘  └──────────┘  └──────────┘  └──────────┘        │
│                                                                 │
│  [응답 시간 추이]                                                │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  5초 ┤                          ╭╮                       │   │
│  │      ┤      ╭─╮        ╭───╮   │ │                      │   │
│  │  3초 ┤─────╯  ╰──────╯    ╰──╯  ╰─────                 │   │
│  │      ┤                                                  │   │
│  │  1초 ┤                                                  │   │
│  │      └────────────────────────────────────────────────  │   │
│  │       12/20  12/21  12/22  12/23  12/24  12/25  12/26   │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
│  [토큰 사용량]                                                   │
│  ┌─────────────────────────────────────────────────────────┐   │
│  │  ████ 입력 토큰: 45,000                                  │   │
│  │  ████ 출력 토큰: 30,000                                  │   │
│  └─────────────────────────────────────────────────────────┘   │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

## 7.2 주요 메트릭 설명

### 사용량 메트릭

| 메트릭 | 설명 | 활용 |
|--------|------|------|
| **총 세션** | 고유 대화 수 | 얼마나 많은 사용자가 이용했는지 |
| **총 메시지** | 질문+답변 총 개수 | 전체 사용량 파악 |
| **일평균 메시지** | 하루 평균 메시지 | 일상적 사용 패턴 파악 |

### 성능 메트릭

| 메트릭 | 설명 | 정상 범위 |
|--------|------|----------|
| **평균 응답 시간** | 모든 응답의 평균 | 2~4초 |
| **P50 (중앙값)** | 응답의 50%가 이 시간 이내 | 2~3초 |
| **P95** | 응답의 95%가 이 시간 이내 | 4~6초 |
| **P99** | 응답의 99%가 이 시간 이내 | 6~10초 |

### 토큰 사용량

| 메트릭 | 설명 |
|--------|------|
| **입력 토큰** | 사용자 질문 + 검색된 문서 내용 |
| **출력 토큰** | AI가 생성한 답변 |

## 7.3 용어 설명

### 퍼센타일(Percentile)이란?

응답 시간의 분포를 이해하는 데 사용됩니다:

```
P50 = 2초   → 응답의 절반이 2초 이내
P95 = 4초   → 응답의 95%가 4초 이내 (20개 중 19개)
P99 = 6초   → 응답의 99%가 6초 이내 (100개 중 99개)
```

**왜 중요한가요?**

평균만 보면 일부 느린 응답을 놓칠 수 있습니다:
- 평균 2초인데 P95가 10초라면 → 일부 사용자가 매우 느린 응답을 경험
- 이런 경우 시스템 점검이 필요합니다

### 토큰(Token)이란?

AI가 텍스트를 처리하는 기본 단위입니다:

```
"안녕하세요" → 약 3~5 토큰
"연차휴가 신청 방법을 알려주세요" → 약 10~15 토큰
```

토큰 사용량이 많다는 것은:
- 사용자들이 활발히 이용하고 있음
- 또는 문서 검색 결과가 많이 포함됨

## 7.4 기간별 조회

### 날짜 범위 선택

```
[시작일] 2024-12-01  [종료일] 2024-12-31  [조회]
```

### 일별 상세 데이터

| 날짜 | 세션 | 메시지 | 평균 응답 | 입력 토큰 | 출력 토큰 |
|------|------|--------|----------|----------|----------|
| 12/26 | 15 | 45 | 2.3초 | 5,400 | 3,200 |
| 12/25 | 8 | 22 | 2.1초 | 2,800 | 1,500 |
| 12/24 | 12 | 38 | 2.5초 | 4,100 | 2,800 |

---

# 8. 유지보수 가이드

## 8.1 일상 점검

### 매일 확인 사항

```bash
# 1. 전체 서비스 상태 확인
docker compose ps

# 2. 디스크 사용량 확인
df -h

# 3. 메모리 사용량 확인
free -h

# 4. GPU 상태 확인
nvidia-smi
```

### 정상 상태 확인

모든 컨테이너가 `Up` 상태여야 합니다:

```
NAME                        STATUS
graphrag-vllm-backend       Up (healthy)
graphrag-vllm-frontend      Up
graphrag-vllm-llm           Up (healthy)
...
```

## 8.2 로그 확인

### 서비스별 로그 보기

```bash
# 전체 로그 (최근 100줄)
docker compose logs --tail=100

# 특정 서비스 로그
docker compose logs backend --tail=100
docker compose logs vllm --tail=100

# 실시간 로그 모니터링
docker compose logs -f backend
```

### 주요 확인 포인트

| 로그 유형 | 의미 |
|----------|------|
| `INFO` | 정상 작동 정보 |
| `WARNING` | 주의 필요 (당장 문제 없음) |
| `ERROR` | 오류 발생 (확인 필요) |
| `CRITICAL` | 심각한 오류 (즉시 조치 필요) |

## 8.3 백업

### 백업 대상

| 데이터 | 위치 | 백업 주기 |
|--------|------|----------|
| PostgreSQL | postgres_data 볼륨 | 매일 |
| Neo4j | neo4j_data 볼륨 | 매일 |
| Qdrant | qdrant_data 볼륨 | 주 1회 |
| 업로드 문서 | pdf_storage 볼륨 | 주 1회 |
| 환경설정 | docker/.env | 변경 시 |

### 백업 스크립트

```bash
#!/bin/bash
# backup.sh - 매일 실행

BACKUP_DIR="/backup/graphrag/$(date +%Y%m%d)"
mkdir -p $BACKUP_DIR

# PostgreSQL 백업
docker exec graphrag-vllm-postgres pg_dump -U graphrag graphrag > $BACKUP_DIR/postgres.sql

# Neo4j 백업 (서비스 중지 필요)
docker compose stop neo4j
cp -r /var/lib/docker/volumes/docker_neo4j_data $BACKUP_DIR/neo4j_data
docker compose start neo4j

# 설정 파일 백업
cp docker/.env $BACKUP_DIR/

echo "백업 완료: $BACKUP_DIR"
```

### 백업 자동화 (cron)

```bash
# crontab 편집
crontab -e

# 매일 새벽 3시에 백업 실행
0 3 * * * /home/user/GraphRAG/scripts/backup.sh >> /var/log/graphrag-backup.log 2>&1
```

## 8.4 복원

### PostgreSQL 복원

```bash
# 백업 파일에서 복원
docker exec -i graphrag-vllm-postgres psql -U graphrag graphrag < /backup/graphrag/20241226/postgres.sql
```

### 전체 복원

```bash
# 1. 서비스 중지
docker compose down

# 2. 볼륨 삭제 (주의: 기존 데이터 삭제됨)
docker volume rm docker_postgres_data docker_neo4j_data docker_qdrant_data

# 3. 백업에서 볼륨 복원
# (백업 방식에 따라 다름)

# 4. 서비스 재시작
docker compose up -d
```

## 8.5 업데이트

### 시스템 업데이트 절차

```bash
# 1. 현재 상태 백업
./scripts/backup.sh

# 2. 최신 코드 다운로드
cd ~/GraphRAG
git pull origin main

# 3. 서비스 재빌드 및 재시작
cd docker
docker compose down
docker compose build
docker compose up -d

# 4. 상태 확인
docker compose ps
```

### 업데이트 전 주의사항

1. **반드시 백업** 후 진행
2. **업무 시간 외** 진행 권장
3. 업데이트 후 **기능 테스트** 필수

## 8.6 성능 최적화

### GPU 메모리 관리

```bash
# GPU 메모리 사용량 확인
nvidia-smi

# 메모리 부족 시 vLLM 설정 조정
# docker/.env 파일 수정
VLLM_GPU_MEMORY_UTILIZATION=0.85  # 85%로 제한
```

### 응답 시간 개선

| 증상 | 원인 | 해결책 |
|------|------|--------|
| 응답 느림 | GPU 메모리 부족 | 더 큰 VRAM GPU 사용 |
| 첫 응답 느림 | 모델 로딩 | 사전 워밍업 설정 |
| 검색 느림 | 벡터 DB 비효율 | 인덱스 최적화 |

### 디스크 정리

```bash
# Docker 불필요 리소스 정리
docker system prune -a

# 오래된 로그 삭제
docker compose logs --since="24h" > recent_logs.txt
```

## 8.7 모니터링 도구

### Flower (Celery 모니터링)

접속: http://서버IP:15555

기능:
- 백그라운드 작업 상태 확인
- 실패한 작업 재시도
- 워커 상태 모니터링

### Neo4j Browser (지식 그래프)

접속: http://서버IP:17474

기능:
- 지식 그래프 시각화
- Cypher 쿼리 실행
- 데이터 탐색

---

# 9. 문제 해결

## 9.1 서비스 시작 안 됨

### 증상
```
docker compose ps 실행 시 일부 서비스가 "Exited" 상태
```

### 해결 방법

```bash
# 1. 상세 로그 확인
docker compose logs 문제서비스명

# 2. 서비스 재시작
docker compose restart 문제서비스명

# 3. 전체 재시작
docker compose down
docker compose up -d
```

### 주요 원인 및 해결

| 서비스 | 주요 원인 | 해결책 |
|--------|----------|--------|
| vllm | GPU 메모리 부족 | 다른 GPU 프로세스 종료 |
| backend | DB 연결 실패 | postgres 상태 확인 |
| postgres | 디스크 공간 부족 | 디스크 정리 |

## 9.2 GPU 관련 문제

### 증상: "CUDA out of memory"

```bash
# 1. GPU 메모리 확인
nvidia-smi

# 2. 다른 프로세스가 GPU 사용 중이면 종료
sudo fuser -v /dev/nvidia*

# 3. vLLM 메모리 설정 조정
# docker/.env 수정
VLLM_GPU_MEMORY_UTILIZATION=0.80
```

### 증상: GPU가 인식되지 않음

```bash
# NVIDIA 드라이버 확인
nvidia-smi

# Container Toolkit 확인
docker run --rm --gpus all nvidia/cuda:12.1-base nvidia-smi
```

## 9.3 응답 품질 문제

### 증상: 엉뚱한 답변

**원인 1: 관련 문서 없음**
- 해당 주제의 문서가 업로드되지 않음
- 해결: 관련 문서 업로드

**원인 2: 문서 처리 실패**
- 문서가 완전히 처리되지 않음
- 해결: 문서 상태 확인, 필요시 재업로드

**원인 3: 질문이 모호함**
- 사용자에게 구체적으로 질문하도록 안내

### 증상: 출처가 표시되지 않음

```bash
# 벡터 DB 상태 확인
curl http://localhost:16333/collections

# 검색 결과 확인 (개발자 모드)
# API 직접 호출하여 retrieval 결과 확인
```

## 9.4 연결 문제

### 증상: 웹 페이지 접속 안 됨

```bash
# 1. 서비스 상태 확인
docker compose ps

# 2. 포트 확인
netstat -tlnp | grep 13000

# 3. 방화벽 확인
sudo ufw status
sudo ufw allow 13000
```

### 증상: API 연결 오류

```bash
# 백엔드 헬스 체크
curl http://localhost:18000/api/v1/health

# 로그 확인
docker compose logs backend --tail=50
```

## 9.5 문서 처리 실패

### 증상: 문서 업로드 후 "처리 실패"

```bash
# 1. Celery 워커 상태 확인
docker compose logs celery-worker --tail=100

# 2. 워커 재시작
docker compose restart celery-worker

# 3. 문서 재업로드
```

### 증상: 처리가 오래 걸림

- 큰 PDF 파일 (100페이지 이상)은 처리 시간이 오래 걸릴 수 있음
- 권장: 50페이지 이하로 분할 업로드

## 9.6 긴급 복구

### 전체 시스템 초기화 (최후의 수단)

> **주의**: 모든 데이터가 삭제됩니다. 백업 필수!

```bash
# 1. 모든 서비스 중지
docker compose down

# 2. 모든 볼륨 삭제
docker compose down -v

# 3. 새로 시작
docker compose up -d
```

---

# 10. 부록

## 10.1 포트 목록

| 포트 | 서비스 | 용도 |
|------|--------|------|
| 13000 | Frontend | 웹 인터페이스 |
| 18000 | Backend API | REST API |
| 18001 | vLLM | LLM 추론 |
| 18003 | Embedding | 임베딩 생성 |
| 15432 | PostgreSQL | 메타데이터 DB |
| 17474 | Neo4j Browser | 그래프 시각화 |
| 17687 | Neo4j Bolt | 그래프 쿼리 |
| 16333 | Qdrant HTTP | 벡터 검색 |
| 16379 | Redis | 캐시/세션 |
| 15555 | Flower | 작업 모니터링 |

## 10.2 환경변수 전체 목록

```bash
# 데이터베이스
POSTGRES_USER=graphrag
POSTGRES_PASSWORD=<비밀번호>
POSTGRES_DB=graphrag
NEO4J_PASSWORD=<비밀번호>

# 인증
JWT_SECRET_KEY=<32자 이상 시크릿>
ADMIN_EMAIL=admin@example.com
ADMIN_PASSWORD=<초기 비밀번호>

# LLM 설정
LLM_BACKEND=vllm
VLLM_MODEL=spow12/Ko-Qwen2-7B-Instruct
VLLM_BASE_URL=http://vllm:8000/v1
VLLM_EMBEDDING_MODEL=upskyy/bge-m3-korean
VLLM_EMBEDDING_BASE_URL=http://vllm-embedding:8000/v1

# GPU 설정
VLLM_GPU_MEMORY_UTILIZATION=0.90
VLLM_MAX_MODEL_LEN=4096
```

## 10.3 API 엔드포인트 요약

### 인증

| 메서드 | 경로 | 설명 |
|--------|------|------|
| POST | /api/v1/auth/login | 로그인 |
| POST | /api/v1/auth/logout | 로그아웃 |

### 챗봇 관리

| 메서드 | 경로 | 설명 |
|--------|------|------|
| GET | /api/v1/chatbots | 목록 조회 |
| POST | /api/v1/chatbots | 생성 |
| GET | /api/v1/chatbots/{id} | 상세 조회 |
| PUT | /api/v1/chatbots/{id} | 수정 |
| DELETE | /api/v1/chatbots/{id} | 삭제 |

### 문서 관리

| 메서드 | 경로 | 설명 |
|--------|------|------|
| GET | /api/v1/chatbots/{id}/documents | 문서 목록 |
| POST | /api/v1/chatbots/{id}/documents | 문서 업로드 |
| DELETE | /api/v1/chatbots/{id}/documents/{doc_id} | 문서 삭제 |

### 채팅

| 메서드 | 경로 | 설명 |
|--------|------|------|
| POST | /api/v1/chat/{chatbot_id}/message | 메시지 전송 (SSE) |

### 통계

| 메서드 | 경로 | 설명 |
|--------|------|------|
| GET | /api/v1/chatbots/{id}/stats | 일별 통계 |
| GET | /api/v1/chatbots/{id}/stats/performance | 성능 메트릭 |

## 10.4 문의 및 지원

### 기술 지원

- **이메일**: support@example.com
- **GitHub Issues**: https://github.com/edumagiceco/GraphRAG/issues

### 문서 업데이트

이 매뉴얼은 시스템 업데이트에 따라 변경될 수 있습니다.
최신 버전은 GitHub 저장소에서 확인하세요.

---

**문서 끝**

*이 문서는 GraphRAG 챗봇 플랫폼 v1.0을 기준으로 작성되었습니다.*
