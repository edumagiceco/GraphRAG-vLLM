# Feature Specification: GraphRAG Chatbot Platform

**Feature Branch**: `001-graphrag-chatbot-platform`
**Created**: 2025-12-22
**Status**: Draft
**Input**: PDF 기반 GraphRAG 챗봇 생성 플랫폼 - 관리자 화면에서 PDF 업로드 및 페르소나 설정을 통해 챗봇 서비스 생성 및 제공

## User Scenarios & Testing *(mandatory)*

### User Story 1 - 챗봇 서비스 생성 (Priority: P1)

관리자는 PDF 문서를 업로드하고 챗봇 페르소나를 설정하여 새로운 챗봇 서비스를 생성한다. 업로드된 PDF는 GraphRAG 방식으로 분석되어 지식 그래프가 구축되고, 이를 기반으로 질문에 답변할 수 있는 챗봇이 생성된다.

**Why this priority**: 이 기능이 핵심 가치 제안이다. 사용자가 PDF만 업로드하면 자동으로 지식 기반 챗봇이 생성되어야 플랫폼의 존재 의미가 있다.

**Independent Test**: PDF 파일 업로드 후 챗봇이 생성되고, 해당 챗봇에게 문서 내용에 관한 질문을 하여 답변을 받을 수 있으면 테스트 완료.

**Acceptance Scenarios**:

1. **Given** 관리자가 로그인한 상태에서, **When** PDF 파일을 업로드하고 챗봇 이름과 페르소나를 입력한 후 생성 버튼을 클릭하면, **Then** 시스템이 문서를 분석하여 챗봇 서비스가 생성되고 고유 접속 URL이 제공된다.
2. **Given** PDF 업로드가 완료된 상태에서, **When** 문서 분석이 진행 중일 때, **Then** 관리자에게 처리 진행률이 표시된다.
3. **Given** 챗봇이 생성된 상태에서, **When** 사용자가 문서 내용에 관련된 질문을 하면, **Then** GraphRAG 기반으로 관련 컨텍스트를 검색하여 정확한 답변을 제공한다.

---

### User Story 2 - 챗봇 서비스 사용 (Priority: P2)

최종 사용자는 생성된 챗봇 서비스에 접속하여 대화형으로 질문하고 답변을 받는다. 챗봇은 업로드된 PDF 문서의 내용을 기반으로 맥락에 맞는 응답을 실시간으로 제공한다.

**Why this priority**: 챗봇 생성 다음으로 중요한 것은 실제 사용자가 챗봇과 대화할 수 있는 인터페이스이다.

**Independent Test**: 생성된 챗봇 URL에 접속하여 질문을 입력하고 스트리밍 방식으로 답변이 표시되는지 확인.

**Acceptance Scenarios**:

1. **Given** 챗봇 서비스 URL에 접속한 상태에서, **When** 사용자가 질문을 입력하고 전송하면, **Then** 실시간 스트리밍으로 답변이 표시된다.
2. **Given** 대화가 진행 중인 상태에서, **When** 이전 질문과 연관된 후속 질문을 하면, **Then** 대화 맥락을 유지하며 답변한다.
3. **Given** 챗봇이 답변 중인 상태에서, **When** 사용자가 중단 버튼을 클릭하면, **Then** 응답 생성이 즉시 중단된다.

---

### User Story 3 - 챗봇 서비스 관리 (Priority: P3)

관리자는 생성된 챗봇 서비스들을 대시보드에서 관리한다. 챗봇별 사용 통계 확인, 활성화/비활성화, 삭제 등의 작업을 수행할 수 있다.

**Why this priority**: 여러 챗봇 서비스를 운영할 때 필요한 관리 기능으로, 핵심 기능이 동작한 이후에 추가되어도 무방하다.

**Independent Test**: 관리 대시보드에서 챗봇 목록 조회, 상태 변경, 삭제가 정상 동작하는지 확인.

**Acceptance Scenarios**:

1. **Given** 관리자가 대시보드에 로그인한 상태에서, **When** 챗봇 목록 페이지에 접근하면, **Then** 모든 생성된 챗봇 서비스가 목록으로 표시된다.
2. **Given** 특정 챗봇을 선택한 상태에서, **When** 비활성화 버튼을 클릭하면, **Then** 해당 챗봇 서비스가 일시 중지되고 사용자 접근이 차단된다.
3. **Given** 특정 챗봇을 선택한 상태에서, **When** 삭제 버튼을 클릭하고 확인하면, **Then** 해당 챗봇과 관련 데이터가 완전히 삭제된다.

---

### User Story 4 - 문서 추가 및 업데이트 (Priority: P4)

관리자는 기존 챗봇에 추가 PDF 문서를 업로드하거나 기존 문서를 교체하여 챗봇의 지식 베이스를 확장 또는 업데이트할 수 있다.

**Why this priority**: 초기 출시 후 지식 베이스 확장 요구가 있을 때 필요한 기능이다.

**Independent Test**: 기존 챗봇에 새 PDF를 추가한 후, 새 문서 내용에 대한 질문에 답변이 가능한지 확인.

**Acceptance Scenarios**:

1. **Given** 기존 챗봇의 상세 페이지에서, **When** 추가 PDF 파일을 업로드하면, **Then** 새 문서가 분석되어 기존 지식 그래프에 통합된다.
2. **Given** 기존 문서 목록에서, **When** 특정 문서를 삭제하면, **Then** 해당 문서의 지식이 그래프에서 제거되고 챗봇이 업데이트된다.

---

### Edge Cases

- PDF 파일이 손상되었거나 읽을 수 없는 형식인 경우 명확한 오류 메시지를 표시하고 업로드를 거부한다.
- PDF가 이미지 스캔본(OCR 필요)인 경우 OCR 처리 후 텍스트를 추출하거나, OCR 미지원 시 사용자에게 텍스트 기반 PDF를 요청한다.
- 매우 큰 PDF 파일(100MB 이상) 업로드 시 처리 시간이 길어질 수 있으며, 비동기 처리 후 완료 알림을 제공한다.
- 동시에 여러 사용자가 같은 챗봇에 질문할 경우 각 세션이 독립적으로 처리된다.
- LLM 서버(Ollama)가 응답하지 않는 경우 사용자에게 일시적 오류 메시지를 표시하고 재시도를 안내한다.
- 빈 PDF 파일이나 텍스트가 없는 PDF 업로드 시 경고 메시지와 함께 처리를 거부한다.

## Requirements *(mandatory)*

### Functional Requirements

**챗봇 생성 및 PDF 처리**
- **FR-001**: 시스템은 관리자가 PDF 파일을 업로드할 수 있는 인터페이스를 제공해야 한다.
- **FR-002**: 시스템은 업로드된 PDF에서 텍스트를 추출하고 GraphRAG 방식으로 지식 그래프를 구축해야 한다.
- **FR-003**: 시스템은 챗봇 생성 시 이름, 설명, 페르소나(응답 스타일/톤) 설정을 지원해야 한다.
- **FR-004**: 시스템은 문서 처리 진행 상태를 실시간으로 표시해야 한다.
- **FR-005**: 시스템은 각 챗봇 서비스에 고유한 접속 URL을 할당해야 한다.

**챗봇 대화 서비스**
- **FR-006**: 시스템은 사용자 질문에 대해 Hybrid Retrieval 방식(Vector Top-K 검색 → 엔티티 기반 Graph 탐색 확장)으로 관련 컨텍스트를 검색하고 답변을 생성해야 한다.
- **FR-007**: 시스템은 답변을 실시간 스트리밍 방식으로 제공해야 한다.
- **FR-008**: 시스템은 대화 세션 내에서 맥락을 유지해야 한다.
- **FR-009**: 시스템은 오픈소스 LLM(Ollama 기반)을 통해 답변을 생성해야 한다.
- **FR-017**: 시스템은 모든 답변에 출처(페이지/섹션)를 필수로 표시해야 한다.
- **FR-018**: 시스템은 문서 근거가 없는 질문에 대해 "답변 불가" 응답을 반환해야 한다.
- **FR-019**: 시스템은 문서 재업로드 시 새 버전의 인덱스를 생성하고 이전 버전을 보존해야 한다.
- **FR-020**: 시스템은 새 인덱스 버전 검증 후 활성화 전환 및 이전 버전으로 롤백 기능을 제공해야 한다.

**관리 기능**
- **FR-010**: 시스템은 관리자 인증 및 권한 관리를 제공해야 한다.
- **FR-011**: 시스템은 생성된 모든 챗봇 서비스의 목록과 상태를 표시해야 한다.
- **FR-012**: 시스템은 챗봇 서비스의 활성화/비활성화/삭제 기능을 제공해야 한다.
- **FR-013**: 시스템은 챗봇별 기본 사용 통계(질문 수, 세션 수)를 제공해야 한다.

**아키텍처 요구사항**
- **FR-014**: 모든 서비스는 Docker 컨테이너로 패키징되어야 한다.
- **FR-015**: 프론트엔드, 백엔드, 데이터베이스는 독립적인 마이크로서비스로 분리되어야 한다.
- **FR-016**: 서비스 간 통신은 RESTful API를 통해 이루어져야 한다.

### Key Entities

- **Chatbot Service**: 하나의 챗봇 인스턴스. 고유 ID, 이름, 설명, 페르소나 설정, 상태(활성/비활성), 생성일, 접속 URL을 가진다.
- **Document**: 업로드된 PDF 문서. 파일 정보, 처리 상태, 소속 챗봇 서비스와의 관계를 가진다.
- **Knowledge Graph**: 문서에서 추출된 엔티티와 관계로 구성된 그래프 구조. 특정 챗봇 서비스에 속한다. 기본 노드타입(개념/정의/프로세스)과 엣지타입(관련/정의/의존)을 제공하며, 도메인별 확장을 허용한다.
- **Conversation Session**: 사용자와 챗봇 간의 대화 세션. 메시지 히스토리와 맥락 정보를 포함한다.
- **Admin User**: 시스템 관리자. 인증 정보와 권한 수준을 가진다.

## Clarifications

### Session 2025-12-22

- Q: Knowledge Graph의 노드/엣지 타입 정의 수준? → A: 확장 가능 기본 스키마 - 핵심 3개 노드타입(개념/정의/프로세스)과 3개 엣지타입(관련/정의/의존) 기본 제공, 도메인별 확장 허용
- Q: Retrieval 전략 (Vector vs Graph 역할 분담)? → A: Hybrid 순차 방식 - Vector Top-K로 관련 청크 검색 후, 청크 내 엔티티를 seed로 Graph 탐색 확장
- Q: Graph 탐색 시 기본 hop(깊이) 제한? → A: 2-hop 제한 - 2단계까지 탐색하여 균형 유지, 대부분의 관계 추론 가능
- Q: 챗봇 답변 시 출처 표시 정책? → A: 강제 출처 표시 - 모든 답변에 출처(페이지/섹션) 필수 표시, 문서 근거 없으면 "답변 불가" 응답
- Q: PDF 재업로드 시 인덱스 버전 관리 정책? → A: 버전 분리 - 재업로드 시 새 버전 인덱스 생성, 이전 버전 보존(롤백 가능), 검증 후 활성화 전환

## Assumptions

- 관리자 인증은 표준 이메일/비밀번호 기반 로그인을 사용한다.
- PDF 파일 크기 제한은 100MB로 설정한다.
- 대화 세션 타임아웃은 30분으로 설정한다.
- 기본 LLM 모델은 Ollama의 nemotron-3-nano:30b를 사용하지만, 설정을 통해 다른 모델로 교체 가능해야 한다.
- Graph 탐색은 기본 2-hop으로 제한하여 탐색 폭발을 방지한다.
- 최종 사용자(챗봇 이용자)는 별도의 인증 없이 챗봇 URL로 직접 접근 가능하다.
- 시스템은 한국어와 영어를 기본 지원한다.

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 관리자가 PDF 업로드부터 챗봇 서비스 생성까지 5분 이내에 완료할 수 있다 (10MB 이하 문서 기준).
- **SC-002**: 사용자 질문에 대한 첫 응답 토큰이 3초 이내에 표시된다.
- **SC-003**: 시스템이 동시에 50개 이상의 활성 대화 세션을 처리할 수 있다.
- **SC-004**: 문서 내용과 관련된 질문에 대해 80% 이상의 정확도로 관련 답변을 제공한다.
- **SC-005**: 단일 서버 환경에서 10개 이상의 독립적인 챗봇 서비스를 동시에 운영할 수 있다.
- **SC-006**: 관리자가 챗봇 관리 작업(활성화/비활성화/삭제)을 3번의 클릭 이내에 완료할 수 있다.
